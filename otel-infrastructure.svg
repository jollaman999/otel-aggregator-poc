<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1400" width="1600" height="1400">
  <!-- Define styles -->
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #333; stroke-width: 2; }
      .cluster { fill: #f0f0f0; stroke: #666; stroke-width: 2; stroke-dasharray: 5,5; }
      .vip-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 3; }
      .master-box { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .backup-box { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .storage-box { fill: #e8f5e9; stroke: #388e3c; stroke-width: 2; }
      .client-box { fill: #fce4ec; stroke: #c2185b; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 14px; fill: #333; text-anchor: middle; }
      .text-small { font-family: Arial, sans-serif; font-size: 11px; fill: #666; text-anchor: middle; }
      .title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #1a237e; text-anchor: middle; }
      .label { font-family: Arial, sans-serif; font-size: 10px; fill: #666; }
      .line { stroke: #333; stroke-width: 2; fill: none; }
      .line-blue { stroke: #1976d2; stroke-width: 2; fill: none; }
      .line-orange { stroke: #f57c00; stroke-width: 2; fill: none; }
      .line-green { stroke: #388e3c; stroke-width: 2; fill: none; }
      .line-purple { stroke: #7b1fa2; stroke-width: 2; fill: none; }
      .line-brown { stroke: #5d4037; stroke-width: 2; fill: none; }
      .arrow { stroke: #333; stroke-width: 2; fill: #333; }
    </style>

    <!-- Define arrow markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976d2" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f57c00" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#388e3c" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7b1fa2" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="800" y="30" class="title">OpenTelemetry High Availability Infrastructure</text>

  <!-- External Clients -->
  <rect x="700" y="60" width="200" height="60" class="client-box" rx="5"/>
  <text x="800" y="85" class="text">External Clients</text>
  <text x="800" y="105" class="text-small">(OTLP/HTTP)</text>

  <!-- Virtual IP -->
  <rect x="650" y="160" width="300" height="100" class="vip-box" rx="5"/>
  <text x="800" y="185" class="text" style="font-weight: bold;">Virtual IP: 192.168.110.140</text>
  <text x="800" y="205" class="text-small">OTLP :4318 | Thanos QF :19193</text>
  <text x="800" y="225" class="text-small">Thanos Q :9192 | Loki :3100</text>
  <text x="800" y="245" class="text-small">(Keepalived VRRP)</text>

  <!-- Node 1 (MASTER) -->
  <rect x="50" y="300" width="650" height="550" class="cluster" rx="10"/>
  <text x="375" y="325" class="text" style="font-weight: bold;">Node 1 - MASTER (192.168.110.214)</text>

  <!-- Node 1: HAProxy + Keepalived -->
  <rect x="80" y="340" width="180" height="80" class="master-box" rx="5"/>
  <text x="170" y="365" class="text">Keepalived</text>
  <text x="170" y="385" class="text-small">Priority: 100</text>
  <text x="170" y="405" class="text-small">HAProxy :4318/19193/9192/3100</text>

  <!-- Node 1: OTel Aggregator -->
  <rect x="280" y="340" width="140" height="80" class="master-box" rx="5"/>
  <text x="350" y="365" class="text">OTel Aggregator</text>
  <text x="350" y="385" class="text-small">:14318 (HTTP)</text>
  <text x="350" y="405" class="text-small">:14317 (gRPC)</text>

  <!-- Node 1: Prometheus -->
  <rect x="80" y="450" width="140" height="80" class="master-box" rx="5"/>
  <text x="150" y="475" class="text">Prometheus</text>
  <text x="150" y="495" class="text-small">:19090</text>
  <text x="150" y="515" class="text-small">Retention: 2h</text>

  <!-- Node 1: Thanos Sidecar -->
  <rect x="240" y="450" width="140" height="80" class="master-box" rx="5"/>
  <text x="310" y="475" class="text">Thanos Sidecar</text>
  <text x="310" y="495" class="text-small">:10901/:10902</text>

  <!-- Node 1: Thanos Receiver -->
  <rect x="80" y="560" width="140" height="80" class="master-box" rx="5"/>
  <text x="150" y="585" class="text">Thanos Receiver</text>
  <text x="150" y="605" class="text-small">:19291/:10907</text>
  <text x="150" y="625" class="text-small">:10909</text>

  <!-- Node 1: Thanos Query -->
  <rect x="240" y="560" width="140" height="80" class="master-box" rx="5"/>
  <text x="310" y="585" class="text">Thanos Query</text>
  <text x="310" y="605" class="text-small">:19192/:10904</text>

  <!-- Node 1: Query Frontend -->
  <rect x="400" y="560" width="140" height="80" class="master-box" rx="5"/>
  <text x="470" y="585" class="text">Query Frontend</text>
  <text x="470" y="605" class="text-small">:29193</text>

  <!-- Node 1: Thanos Store -->
  <rect x="80" y="670" width="140" height="60" class="master-box" rx="5"/>
  <text x="150" y="695" class="text">Thanos Store</text>
  <text x="150" y="715" class="text-small">:10905/:10906</text>

  <!-- Node 1: Compactor -->
  <rect x="240" y="670" width="140" height="60" class="master-box" rx="5"/>
  <text x="310" y="695" class="text">Compactor</text>
  <text x="310" y="715" class="text-small">:10912</text>

  <!-- Node 1: Loki -->
  <rect x="450" y="340" width="220" height="80" class="master-box" rx="5"/>
  <text x="560" y="365" class="text">Loki</text>
  <text x="560" y="385" class="text-small">:13100</text>
  <text x="560" y="405" class="text-small">Retention: 90 days</text>

  <!-- Node 1: MinIO -->
  <rect x="450" y="450" width="220" height="80" class="master-box" rx="5"/>
  <text x="560" y="475" class="text">MinIO Node 1</text>
  <text x="560" y="495" class="text-small">:9000 (S3 API)</text>
  <text x="560" y="515" class="text-small">/data1 + /data2</text>

  <!-- Node 2 (BACKUP) -->
  <rect x="900" y="300" width="650" height="550" class="cluster" rx="10"/>
  <text x="1225" y="325" class="text" style="font-weight: bold;">Node 2 - BACKUP (192.168.110.119)</text>

  <!-- Node 2: HAProxy + Keepalived -->
  <rect x="1370" y="340" width="160" height="80" class="backup-box" rx="5"/>
  <text x="1450" y="365" class="text">Keepalived</text>
  <text x="1450" y="385" class="text-small">Priority: 90</text>
  <text x="1450" y="405" class="text-small">HAProxy :4318/...</text>

  <!-- Node 2: OTel Aggregator -->
  <rect x="1180" y="340" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1250" y="365" class="text">OTel Aggregator</text>
  <text x="1250" y="385" class="text-small">:14318 (HTTP)</text>
  <text x="1250" y="405" class="text-small">:14317 (gRPC)</text>

  <!-- Node 2: Prometheus -->
  <rect x="1370" y="450" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1440" y="475" class="text">Prometheus</text>
  <text x="1440" y="495" class="text-small">:19090</text>
  <text x="1440" y="515" class="text-small">Retention: 2h</text>

  <!-- Node 2: Thanos Sidecar -->
  <rect x="1210" y="450" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1280" y="475" class="text">Thanos Sidecar</text>
  <text x="1280" y="495" class="text-small">:10901/:10902</text>

  <!-- Node 2: Thanos Receiver -->
  <rect x="1370" y="560" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1440" y="585" class="text">Thanos Receiver</text>
  <text x="1440" y="605" class="text-small">:19291/:10907</text>
  <text x="1440" y="625" class="text-small">:10909</text>

  <!-- Node 2: Thanos Query -->
  <rect x="1210" y="560" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1280" y="585" class="text">Thanos Query</text>
  <text x="1280" y="605" class="text-small">:19192/:10904</text>

  <!-- Node 2: Query Frontend -->
  <rect x="1050" y="560" width="140" height="80" class="backup-box" rx="5"/>
  <text x="1120" y="585" class="text">Query Frontend</text>
  <text x="1120" y="605" class="text-small">:29193</text>

  <!-- Node 2: Thanos Store -->
  <rect x="1370" y="670" width="140" height="60" class="backup-box" rx="5"/>
  <text x="1440" y="695" class="text">Thanos Store</text>
  <text x="1440" y="715" class="text-small">:10905/:10906</text>

  <!-- Node 2: Compactor -->
  <rect x="1210" y="670" width="140" height="60" class="backup-box" rx="5"/>
  <text x="1280" y="695" class="text">Compactor</text>
  <text x="1280" y="715" class="text-small">:10912</text>

  <!-- Node 2: Loki -->
  <rect x="930" y="340" width="220" height="80" class="backup-box" rx="5"/>
  <text x="1040" y="365" class="text">Loki</text>
  <text x="1040" y="385" class="text-small">:13100</text>
  <text x="1040" y="405" class="text-small">Retention: 90 days</text>

  <!-- Node 2: MinIO -->
  <rect x="930" y="450" width="220" height="80" class="backup-box" rx="5"/>
  <text x="1040" y="475" class="text">MinIO Node 2</text>
  <text x="1040" y="495" class="text-small">:9000 (S3 API)</text>
  <text x="1040" y="515" class="text-small">/data1 + /data2</text>

  <!-- MinIO Distributed Cluster -->
  <rect x="600" y="1000" width="400" height="180" class="storage-box" rx="10"/>
  <text x="800" y="1025" class="text" style="font-weight: bold;">MinIO Distributed Cluster</text>
  <text x="800" y="1045" class="text-small">(Erasure Coding)</text>

  <!-- MinIO Buckets -->
  <rect x="650" y="1070" width="140" height="80" class="storage-box" rx="5"/>
  <text x="720" y="1095" class="text">Bucket:</text>
  <text x="720" y="1115" class="text">thanos-metrics</text>
  <text x="720" y="1135" class="text-small">(Metrics Storage)</text>

  <rect x="810" y="1070" width="140" height="80" class="storage-box" rx="5"/>
  <text x="880" y="1095" class="text">Bucket:</text>
  <text x="880" y="1115" class="text">loki-data</text>
  <text x="880" y="1135" class="text-small">(Logs Storage)</text>

  <!-- Connections: Clients to VIP -->
  <line x1="800" y1="120" x2="800" y2="160" class="line-blue" marker-end="url(#arrowhead-blue)"/>
  <text x="830" y="145" class="label" fill="#1976d2">OTLP/HTTP</text>

  <!-- VIP to Node 1 HAProxy -->
  <line x1="700" y1="260" x2="170" y2="340" class="line" marker-end="url(#arrowhead)"/>
  <text x="400" y="295" class="label">VRRP Failover</text>

  <!-- VIP to Node 2 HAProxy -->
  <line x1="900" y1="260" x2="1450" y2="340" class="line" marker-end="url(#arrowhead)"/>

  <!-- Node 1: HAProxy to OTel -->
  <line x1="260" y1="380" x2="280" y2="380" class="line-blue" marker-end="url(#arrowhead-blue)"/>

  <!-- Node 1: OTel to Prometheus -->
  <line x1="310" y1="420" x2="190" y2="450" class="line-green" marker-end="url(#arrowhead-green)"/>
  <text x="240" y="435" class="label" fill="#388e3c">Remote Write</text>

  <!-- Node 1: OTel to Loki -->
  <line x1="420" y1="380" x2="450" y2="380" class="line-orange" marker-end="url(#arrowhead-orange)"/>
  <text x="435" y="375" class="label" fill="#f57c00">Logs</text>

  <!-- Node 1: Prometheus to Thanos Sidecar -->
  <line x1="220" y1="490" x2="240" y2="490" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 1: Prometheus to Thanos Receiver -->
  <line x1="150" y1="530" x2="150" y2="560" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <text x="175" y="545" class="label" fill="#7b1fa2">Remote Write</text>

  <!-- Node 1: Query Frontend to Query -->
  <line x1="400" y1="600" x2="380" y2="600" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 1: Thanos Query to Store/Sidecar/Receiver -->
  <line x1="280" y1="620" x2="220" y2="650" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <line x1="310" y1="560" x2="310" y2="530" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 1: Thanos components to MinIO bucket -->
  <line x1="310" y1="530" x2="560" y2="530" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <line x1="150" y1="730" x2="650" y2="950" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <text x="350" y="840" class="label" fill="#7b1fa2">Upload Blocks</text>

  <!-- Node 1: Loki to MinIO bucket -->
  <line x1="620" y1="420" x2="830" y2="920" class="line-orange" marker-end="url(#arrowhead-orange)"/>
  <text x="730" y="670" class="label" fill="#f57c00">Store Logs</text>

  <!-- Node 1: MinIO to Buckets -->
  <line x1="560" y1="530" x2="720" y2="1000" class="line-brown" marker-end="url(#arrowhead)"/>

  <!-- Node 2: HAProxy to OTel -->
  <line x1="1370" y1="380" x2="1320" y2="380" class="line-blue" marker-end="url(#arrowhead-blue)"/>

  <!-- Node 2: OTel to Prometheus -->
  <line x1="1290" y1="420" x2="1400" y2="450" class="line-green" marker-end="url(#arrowhead-green)"/>

  <!-- Node 2: OTel to Loki -->
  <line x1="1180" y1="380" x2="1150" y2="380" class="line-orange" marker-end="url(#arrowhead-orange)"/>

  <!-- Node 2: Prometheus to Thanos Sidecar -->
  <line x1="1370" y1="490" x2="1350" y2="490" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 2: Prometheus to Thanos Receiver -->
  <line x1="1440" y1="530" x2="1440" y2="560" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 2: Query Frontend to Query -->
  <line x1="1190" y1="600" x2="1210" y2="600" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 2: Thanos Query to Store/Sidecar -->
  <line x1="1310" y1="640" x2="1370" y2="650" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <line x1="1280" y1="560" x2="1280" y2="530" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 2: Thanos components to MinIO bucket -->
  <line x1="1440" y1="730" x2="770" y2="1000" class="line-purple" marker-end="url(#arrowhead-purple)"/>

  <!-- Node 2: Loki to MinIO bucket -->
  <line x1="980" y1="420" x2="850" y2="950" class="line-orange" marker-end="url(#arrowhead-orange)"/>

  <!-- Node 2: MinIO to Buckets -->
  <line x1="1040" y1="530" x2="880" y2="1000" class="line-brown" marker-end="url(#arrowhead)"/>

  <!-- Cross-node: Prometheus to opposite Receiver -->
  <line x1="220" y1="600" x2="1380" y2="600" class="line-purple" style="stroke-dasharray: 5,5" marker-end="url(#arrowhead-purple)"/>
  <text x="800" y="595" class="label" fill="#7b1fa2">Cross-node Remote Write</text>

  <!-- MinIO inter-node replication -->
  <line x1="670" y1="490" x2="930" y2="490" class="line-brown" style="stroke-dasharray: 5,5"/>
  <text x="800" y="485" class="label" fill="#5d4037">Distributed Cluster</text>

  <!-- Legend -->
  <rect x="50" y="1250" width="1500" height="120" fill="#fafafa" stroke="#999" stroke-width="1" rx="5"/>
  <text x="800" y="1275" class="text" style="font-weight: bold;">Legend</text>

  <line x1="100" y1="1300" x2="150" y2="1300" class="line-blue" marker-end="url(#arrowhead-blue)"/>
  <text x="200" y="1305" class="text-small" style="text-anchor: start;">OTLP Data Flow</text>

  <line x1="400" y1="1300" x2="450" y2="1300" class="line-green" marker-end="url(#arrowhead-green)"/>
  <text x="500" y="1305" class="text-small" style="text-anchor: start;">Metrics Flow</text>

  <line x1="700" y1="1300" x2="750" y2="1300" class="line-orange" marker-end="url(#arrowhead-orange)"/>
  <text x="800" y="1305" class="text-small" style="text-anchor: start;">Logs Flow</text>

  <line x1="1000" y1="1300" x2="1050" y2="1300" class="line-purple" marker-end="url(#arrowhead-purple)"/>
  <text x="1100" y="1305" class="text-small" style="text-anchor: start;">Thanos gRPC/Storage</text>

  <line x1="100" y1="1330" x2="150" y2="1330" class="line-brown" marker-end="url(#arrowhead)"/>
  <text x="200" y="1335" class="text-small" style="text-anchor: start;">MinIO Storage</text>

  <line x1="400" y1="1330" x2="450" y2="1330" class="line" style="stroke-dasharray: 5,5"/>
  <text x="500" y="1335" class="text-small" style="text-anchor: start;">Cross-node Communication</text>

  <rect x="700" y="1315" width="30" height="20" class="vip-box" rx="2"/>
  <text x="780" y="1330" class="text-small" style="text-anchor: start;">VIP/Load Balancer</text>

  <rect x="1000" y="1315" width="30" height="20" class="storage-box" rx="2"/>
  <text x="1080" y="1330" class="text-small" style="text-anchor: start;">Storage Layer</text>
</svg>
